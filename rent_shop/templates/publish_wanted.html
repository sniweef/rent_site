<!DOCTYPE html>
<html lang='zh-CN'>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        {% include 'include_files.html' %}
        <script type='text/javascript'>
            $(function() {
                $('a').click(function() {
                    $(this).closest('ul').prev().prev().text($(this).text());
                });
                $(':checkbox').click(function() {
                    //alert($(this).attr('class'));
                    var class_name = $(this).prop('class');
                    $('.'+class_name).prop('checked', false);
                    $(this).prop('checked', true);
                });
                {% if wanted_shop %}
                var type_id_map = {
                    '个人': 'personal',
                    '加盟商': 'franchisee',
                    '公司': 'company'
                };
                $('#'+type_id_map['{{ wanted_shop.wanter_type }}']).prop('checked', true);
                {% endif %}
            });
            function publish_want() {
                console.log($('#upload_form :input'));
                console.log($('#upload_form input'));
                console.log($('#upload_form').serializeArray());
                var form_data = new FormData();
                var is_buy = 0;
                if ($('#buy_cb').prop('checked'))
                {
                    is_buy = 1;
                }
                form_data.append('is_buy', is_buy);
                form_data.append('business_type', is_buy);
                $.ajax({
                    type:'POST',
                    url:'/wanted/publish',
                    data:form_data,
                    /**
                     *必须false才会自动加上正确的Content-Type
                     */
                    contentType:false,
                    /**
                     * 必须false才会避开jQuery对 formdata 的默认处理
                     * XMLHttpRequest会对 formdata 进行正确的处理
                     */
                    processData:false,
                    error: function(jqxhr, text_status, error_thrown) {
                        console.log(text_status, error_thrown);
                        console.log(jqxhr.responseText);
                        $('.bg-danger').text(jqxhr.responseText);
                    },
                    success: function(data, text_status, jqxhr) {
                    }
                });
                //$('#upload_form').submit();
            }

        </script>
    </head>
    <body>
    <div class="panel panel-default">
        <div class="panel-heading">
            {% include "navigation.html" %}
        </div>
        <div class="panel-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xs-12">
                        <form class="bs-example bs-example-form" data-example-id="simple-input-groups" name="upload_form" id="upload_form">
                            <div class="input-group">
                        <span class="input-group-addon ">
                            <input type="checkbox" aria-label="..." class="rent_or_buy" value="0" {% if wanted_shop and not wanted_shop.is_buy %}checked="checked" {% endif %}>
                            <span>承租</span>
                        </span>
                        <span class="input-group-addon">
                            <input type="checkbox" aria-label="..." class="rent_or_buy" id="buy_cb" value="1" {% if wanted_shop and wanted_shop.is_buy %}checked="checked" {% endif %}>
                            <span>购买</span>
                        </span>
                                <span>  </span>
                        <span class="input-group-addon">
                            <input type="checkbox" aria-label="..." class="wanter_type" id="personal">
                            <span>个人</span>
                        </span>
                        <span class="input-group-addon">
                            <input type="checkbox" aria-label="..." class="wanter_type" id="franchisee">
                            <span>加盟商</span>
                        </span>
                        <span class="input-group-addon">
                            <input type="checkbox" aria-label="..." class="wanter_type" id="company">
                            <span>公司</span>
                        </span>
                            </div><!-- /input-group -->
                            <div class="input-group">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {% if wanted_shop %} {{ wanted_shop.intention_type }} {% else %}意向类型{% endif %}<span class="caret"></span></button>
                                    <ul class="dropdown-menu dropdown-menu-left">
                                        <li><a >购物中心</a></li>
                                        <li><a >步行街</a></li>
                                        <li><a >星级酒店</a></li>
                                        <li><a >社区商业</a></li>
                                    </ul>
                                </div>
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {% if wanted_shop %} {{ wanted_shop.business_type }} {% else %}经营类型{% endif %}<span class="caret"></span></button>
                                    <ul class="dropdown-menu dropdown-menu-right">
                                        <li><a >零售</a></li>
                                        <li><a >专卖</a></li>
                                        <li><a >餐饮</a></li>
                                        <li><a >娱乐</a></li>
                                        <li><a >生活服务</a></li>
                                        <li><a >银行</a></li>
                                        <li><a >金融</a></li>
                                    </ul>
                                </div>
                                <span class="input-group-addon">品牌名称</span>
                                <input type="text" class="form-control" aria-label="..." value="{{ wanted_shop.brand_name if wanted_shop }}">
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">使用面积</span>
                                <input type="text" class="form-control" placeholder="" aria-describedby="basic-addon2" value="{{ wanted_shop.area if wanted_shop }}">
                                <span class="input-group-addon" id="basic-addon2">m<sup>2</sup></span>
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">意向价格</span>
                                <input type="text" class="form-control" placeholder="" aria-describedby="basic-addon2" value="{{ wanted_shop.intention_price if wanted_shop }}">
                                <span class="input-group-addon" id="basic-addon2">m<sup>2</sup></span>
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">工程需求</span>
                                <input type="text" class="form-control" placeholder="" aria-describedby="basic-addon2" value="{{ wanted_shop.project_demand if wanted_shop }}">
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">联系人</span>
                                <input type="text" class="form-control" placeholder="" aria-describedby="basic-addon2" value="{{ wanted_shop.contacter if wanted_shop }}">
                            </div>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">联系方式</span>
                                <input type="text" class="form-control" placeholder="" aria-describedby="basic-addon2"
                                        value="{{ wanted_shop.phone if wanted_shop }}">
                            </div>
                            <p class="bg-danger"></p>
                            {% if editable %}
                            <button type="button" class="btn btn-primary" onclick="publish_want()">提交</button>
                            {% endif %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </body>
</html>
